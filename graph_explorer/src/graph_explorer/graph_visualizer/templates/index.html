{% extends 'base.html' %}
{% block title %}Index - {{ block.super }}{% endblock %}
{% block content %}
    {% comment %} <p>Hello, {{ name }}!</p> {% endcomment %}
    {% comment %} {{ simple_visualizer|safe|escape }} {% endcomment %}
    <section class="columns is-fullheight">
        <aside class="column is-2 is-narrow-mobile is-fullheight is-hidden-mobile">
            <nav class="panel side-panel">
                <p class="panel-heading has-text-black has-background-light">Workspaces</p>
                <div class="panel-block is-flex-direction-column is-justify-content-space-between">
                    <ul class="menu-list">
                        {% for workspace in workspaces %}
                            <li>
                                <a href="{% url 'workspace' workspace.id %}" class="">
                                    <div class="card {% if workspace.is_active %}is-selected{% endif %}">
                                        <header class="card-header  is-flex is-align-items-center is-justify-content-center">
                                            <p class="card-header-title">{{ workspace.name }}</p>
                                            <div class="is-flex pr-2">
                                                <a href="#" class="card-header-icon" aria-label="edit">
                                                    <span class="icon">
                                                        <i class="fas fa-edit"></i>
                                                    </span>
                                                </a>
                                                <a href="#" class="card-header-icon" aria-label="delete">
                                                    <span class="icon  has-text-danger">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </span>
                                                </a>
                                            </div>
                                        </header>
                                    </div>
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                    <button class="js-modal-trigger button" data-target="workspace-modal">Create workspace</button>
                </div>
            </nav>
        </aside>
        <div class="vertical-container column  is-fullheight is-3 ">
            <nav class="panel">
                <p class="panel-heading has-text-black has-background-light">Visualizer</p>
                <div class="panel-block">
                    {% if visualizers %}
                        <div class="select is-rounded is-fullwidth">
                            <select onChange="onVisualizerChange(this.value)">
                                <option value="" disabled selected hidden>Select Visualizer</option>
                                {% for visualizer in visualizers %}
                                    <option value="{{ visualizer.id }}"
                                            {% if visualizer.id == selected_visualizer_id %}selected{% endif %}>
                                        {{ visualizer.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    {% else %}
                        <h3>No visualizer plugins found</h3>
                    {% endif %}
                </div>
            </nav>
            <nav class="panel">
                <p class="panel-heading has-text-black has-background-light">Tree View</p>
                <div class="panel-block">
                    <h3>Tree view</h3>
                </div>
            </nav>
            <nav class="panel">
                <p class="panel-heading has-text-black has-background-light">Bird View</p>
                <div class="panel-block">
                    {% if bird_view %}
                        <div class="main-view" id="bird-view-{{ bird_view.visualizer_id }}">{{ bird_view.html|safe }}</div>
                    {% else %}
                        <h3>No workspace selected</h3>
                    {% endif %}
                </div>
            </nav>
        </div>
        <div class="vertical-container column is-fullheight is-7">
            <nav class="panel">
                <p class="panel-heading has-text-black has-background-light">Filter</p>
                <div class="panel-block is-flex-direction-column is-gap-2">
                    <form class="filter-form is-flex" action="#" method="post">
                        <input id="search-input"
                               class="input"
                               type="text"
                               placeholder="Search"
                               name="query" />
                        <input type="submit" value="Search" class="button" />
                    </form>
                    <form id="filter-form"
                          class="filter-form is-flex is-flex-direction-row"
                          method="post"
                          action="#">
                        <input name="attribute"
                               id="filter-attribute-input"
                               class="input"
                               type="text"
                               placeholder="Attribute" />
                        <div class="select">
                            <select name="operator">
                                <option value="" disabled selected hidden>Select Operator...</option>
                                <option value="eq">=</option>
                                <option value="gt">&#62;</option>
                                <option value="ge">&#62;=</option>
                                <option value="lt">&#60;</option>
                                <option value="le">&#60;=</option>
                                <option value="ne">!=</option>
                                <option value="xor">xor</option>
                            </select>
                        </div>
                        <input name="value"
                               id="filter-value-input"
                               class="input"
                               type="text"
                               placeholder="Value" />
                        <input type="submit" value="Filter" class="button" />
                    </form>
                </div>
            </nav>
            <nav class="panel">
                <p class="panel-heading has-text-black has-background-light">Main View</p>
                <div class="panel-block">
                    {% if main_view %}
                        <div class="main-view" id="main-view-{{ main_view.visualizer_id }}">{{ main_view.html|safe }}</div>
                    {% else %}
                        <h3>No workspace selected</h3>
                    {% endif %}
                </div>
            </nav>
        </div>
    </section>
    <div id="workspace-modal" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Configure workspace</p>
                <button class="delete" aria-label="close"></button>
            </header>
            <section class="modal-card-body is-flex is-flex-direction-column is-gap-2">
                <div class="select is-rounded is-fullwidth">
                    <select id="data-source-drop-down">
                        <option value="" disabled selected hidden>Select Datasource</option>
                        {% for source in data_sources %}<option value="{{ source.name }}">{{ source.name }}</option>{% endfor %}
                    </select>
                </div>
                <div id="data-source-file" class="file has-name">
                    <label class="file-label">
                        <input class="file-input" type="file" name="resume" />
                        <span class="file-cta">
                            <span class="file-icon">
                                <i class="fas fa-upload"></i>
                            </span>
                            <span class="file-label">Choose a fileâ€¦</span>
                        </span>
                        <span class="file-name">No file uploaded</span>
                    </label>
                </div>
                <script>
                    const fileInput = document.querySelector("#data-source-file input[type=file]");
                    fileInput.onchange = () => {
                      if (fileInput.files.length > 0) {
                        const fileName = document.querySelector("#data-source-file .file-name");
                        fileName.textContent = fileInput.files[0].name;
                      }
                    };
                </script>
            </section>
            <footer class="modal-card-foot is-justify-content-center">
                <div class="buttons">
                    <button class="button is-success">Save changes</button>
                    <button class="button">Cancel</button>
                </div>
            </footer>
        </div>
    </div>
{% endblock %}
