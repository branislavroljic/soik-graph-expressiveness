<!DOCTYPE html>

  <style>
        .node {
            cursor: pointer;
            fill:rgb(230, 238, 238);
            border : 1px solid black;
          }
      
      
          .link {
            stroke: #0f0;
            fill: none;
            stroke-width: 2px;
          }
    .selected {
        fill: rgb(209, 231, 12);
    }
     
   
  </style>


  <svg width="100%" height="1000" id="svg-simple_graph_visualizer">
  </svg>
  <script type="text/javascript" src="https://d3js.org/d3.v7.js"></script>
  <div id="tooltip"
       class="tooltip"
       style="position: absolute;
              display: none;
              padding: 10px;
              background: rgba(0, 0, 0, 0.6);
              color: white;
              border-radius: 5px;
              font-size: 16px;
              pointer-events: none;
              min-width: 100px"></div>
  <script>
    var nodes = [
      
      {
        id:"1", 
        name:"A",
      },
      
      {
        id:"2", 
        name:"B",
      },
      
      {
        id:"3", 
        name:"C",
      },
      
      {
        id:"4", 
        name:"DANAS",
      },
      
      {
        id:"5", 
        name:"E",
      },
      
      {
        id:"6", 
        name:"F",
      },
      
      {
        id:"7", 
        name:"G",
      },
      
      {
        id:"8", 
        name:"H",
      },
      
      {
        id:"9", 
        name:"I",
      },
      
      {
        id:"10", 
        name:"J",
      },
      
      ];
      
    var links = [
        
        {
            source:"1",
            target:"2",
        },
        
        {
            source:"3",
            target:"4",
        },
        
        {
            source:"9",
            target:"9",
        },
        
        {
            source:"5",
            target:"1",
        },
        
        {
            source:"2",
            target:"3",
        },
        
        {
            source:"6",
            target:"7",
        },
        
        {
            source:"4",
            target:"5",
        },
        
        {
            source:"10",
            target:"10",
        },
        
        {
            source:"8",
            target:"6",
        },
        
        {
            source:"7",
            target:"8",
        },
        
    ];

    links = links.map(link => ({
        ...link,
        source: nodes.find(n => n.id === link.source),
        target: nodes.find(n => n.id === link.target),
    }));

    var svg=d3.select('#svg-simple_graph_visualizer');

    svg.append("svg:defs")
    .append("svg:marker")
    .attr("id", "arrow")
    .attr("viewBox", "0 0 10 10")
    .attr("refX", 0)
    .attr("refY", 5)
    .attr("markerUnits", "strokeWidth")
    .attr("markerWidth", 8)
    .attr("markerHeight", 6)
    .attr("orient", "auto")
    .append("svg:path").
    attr("d", "M 0 0 L 10 5 L 0 10 z");

    const simulation = d3.forceSimulation(nodes)
    .force("link", d3.forceLink().links(links).distance(300))
    .force("charge", d3.forceManyBody().strength(100))
    .force("center", d3.forceCenter(700 / 2, 700 / 2))
    .force("gravity", d3.forceManyBody().strength(-100))
    .force("collide", d3.forceCollide().radius(80))
    .on("tick", tick);


    
    const handleZoom = (e) => g.attr('transform', e.transform);
    const zoom = d3.zoom().on('zoom', handleZoom);

    var g = d3.select('#svg-simple_graph_visualizer').call(zoom).append('g');


    var tooltip = d3.select("#tooltip");

    function displayTooltip(event, d) {
      var dataStrings = Object.entries(d.data).map(function([key, value]) {
        return `${key}: ${value}`;
      });

      var tooltipText = dataStrings.join("<br>");

      tooltip
        .html(tooltipText)
        .style('display', 'inline-block')
        .style('left', (event.pageX + 10) + 'px')
        .style('top', (event.pageY + 10) + 'px');
    }

    function hideTooltip() {
      tooltip.style('display', 'none');
    }

   
    // add the links
    const link = g.selectAll(".link")
    .data(links)
    .enter()
    .append("path")
    .on('mouseover', displayTooltip)
    .on('mouseout', hideTooltip)
    
    .attr("marker-end", "url(#arrow)")
    
    .attr("class", "link");

    var node = g.selectAll('.node')
    .data(nodes)
    .enter()
    .append('g')
    .attr('class', 'node')
    .attr('id', n => "node_" + n.id)
    .call(drag(simulation));

    d3.selectAll('.node').each(n => complexView(n));

    function complexView(node){
      textSize=15;
      radius = 25;
    
        d3.select("g#node_"+node.id).append('circle')
        .attr("r", n => n.name.length + radius)
        .attr('x',0).attr('y',0);
        
        d3.select("g#node_"+node.id).append('text')
        .attr('x',0)
        .attr('y',0)
        .attr('font-size',textSize)
        .attr('font-family','sans-serif')
        .attr('text-anchor','middle')
        .attr('fill', 'black')
        .text(node.name);

    }

    function tick() {

        textSize=15;
      radius = 20;
        var arrowheadLength = 8;
  

        var node = g.selectAll('.node');
        var link = g.selectAll(".link");

       node.attr("transform", d => "translate(" + d.x + "," + d.y + ")")
            
    
       
        link.attr("d", function(d) {
          var x1 = d.source.x,
              y1 = d.source.y,
              x2 = d.target.x,
              y2 = d.target.y,
              dx = x2 - x1,
              dy = y2 - y1,
              angle = Math.atan2(y2 - y1, x2 - x1),
              radius = d.target.name.length + 25,
              dr = Math.sqrt(dx * dx + dy * dy),
              targetX = x2 - Math.cos(angle) * (radius + arrowheadLength),
              targetY = y2 - Math.sin(angle) * (radius + arrowheadLength),
        
              // Defaults for normal edge.
              drx = dr,
              dry = dr,
              xRotation = 0, // degrees
              largeArc = 0, 
              sweep = 1; 
        
              // Self edge
              if ( x1 === x2 && y1 === y2 ) {
                // Fiddle with this angle to get loop oriented.
                xRotation = -45;
        
                // Needs to be 1.
                largeArc = 1;
        
                // Change sweep to change orientation of loop. 
                //sweep = 0;
        
                // Make drx and dry different to get an ellipse
                // instead of a circle.
                drx = 30;
                dry = 20;
              
              } 
        
          return "M" + x1 + "," + y1 + "A" + drx + "," + dry + " " + xRotation + "," + largeArc + "," + sweep + " " + targetX + "," + targetY
        });
          
    }
  
    
  
    function drag(simulation) {    
      function dragstarted(event) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      event.subject.fx = event.subject.x;
      event.subject.fy = event.subject.y;
      }
      
      function dragged(event) {
      event.subject.fx = event.x;
      event.subject.fy = event.y;
      }
      
      function dragended(event) {
      if (!event.active) simulation.alphaTarget(0);
      event.subject.fx = null;
      event.subject.fy = null;
      }
      
      return d3.drag()
      .on("start", dragstarted)
      .on("drag", dragged)
      .on("end", dragended);
  }


  </script>
